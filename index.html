<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Three.js Firebase Character</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
  </style>
</head>
<body>

<!-- Three.js first -->
<script src="https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.161.0/examples/js/geometries/RoundedBoxGeometry.js"></script>

<!-- Firebase (compat version, no import/export) -->
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-database-compat.js"></script>

<!-- Your code goes last -->
<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyC_Op87WdFH-xBlbyBPgH66LilwGZ8Ch5w",
    authDomain: "pasja-data5100s.firebaseapp.com",
    projectId: "pasja-data5100s",
    storageBucket: "pasja-data5100s.firebasestorage.app",
    messagingSenderId: "1042573635103",
    appId: "1:1042573635103:web:9f70d20e5ac49f951b6f2a",
    measurementId: "G-Z2GYGXQTMZ"
  };

  // Init Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Three.js Setup
  const scene = new THREE.Scene();

  const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0, 5, 10);

  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Lights
  scene.add(new THREE.AmbientLight(0xffffff, 0.6));
  const dirLight = new THREE.DirectionalLight(0xffffff, 0.6);
  dirLight.position.set(5, 10, 7);
  scene.add(dirLight);

  // Floor Grid
  const gridHelper = new THREE.GridHelper(100, 100, 0x444444, 0x222222);
  scene.add(gridHelper);

  // Character (Rounded Boxes)
  const mat = new THREE.MeshStandardMaterial({ color: 0x888888 });
  const character = new THREE.Group();

  const head = new THREE.Mesh(new THREE.RoundedBoxGeometry(1.25, 1.25, 1.25, 4, 0.15), mat);
  head.position.y = 3.25;
  character.add(head);

  const torso = new THREE.Mesh(new THREE.RoundedBoxGeometry(2, 2, 1, 4, 0.15), mat);
  torso.position.y = 1.5;
  character.add(torso);

  const leftArm = new THREE.Mesh(new THREE.RoundedBoxGeometry(1, 2, 1, 4, 0.15), mat);
  leftArm.position.set(-1.5, 1.5, 0);
  character.add(leftArm);

  const rightArm = new THREE.Mesh(new THREE.RoundedBoxGeometry(1, 2, 1, 4, 0.15), mat);
  rightArm.position.set(1.5, 1.5, 0);
  character.add(rightArm);

  const leftLeg = new THREE.Mesh(new THREE.RoundedBoxGeometry(1, 2, 1, 4, 0.15), mat);
  leftLeg.position.set(-0.5, -0.5, 0);
  character.add(leftLeg);

  const rightLeg = new THREE.Mesh(new THREE.RoundedBoxGeometry(1, 2, 1, 4, 0.15), mat);
  rightLeg.position.set(0.5, -0.5, 0);
  character.add(rightLeg);

  scene.add(character);

  // Controls
  const keys = {};
  window.addEventListener("keydown", (e) => keys[e.key] = true);
  window.addEventListener("keyup", (e) => keys[e.key] = false);

  // Animation loop
  function animate() {
    requestAnimationFrame(animate);

    const speed = 0.1;
    if (keys["w"]) character.position.z -= speed;
    if (keys["s"]) character.position.z += speed;
    if (keys["a"]) character.position.x -= speed;
    if (keys["d"]) character.position.x += speed;

    // Camera follow
    camera.position.lerp(new THREE.Vector3(
      character.position.x, character.position.y + 5, character.position.z + 10
    ), 0.1);
    camera.lookAt(character.position);

    // Save position to Firebase
    db.ref("player1").set({
      x: character.position.x,
      y: character.position.y,
      z: character.position.z
    });

    renderer.render(scene, camera);
  }
  animate();

  window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>
</body>
</html>
